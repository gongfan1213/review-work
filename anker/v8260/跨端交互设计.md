# 4.5.跨端交互设计
## 4.5.1综述
- 跨端交互当前主要是pc内嵌web页面，内嵌页面是创作平台首页，2d编辑入口页面，3d编辑入口页面，交互动作通过scheme，jsbridge处理的
### 4.5.2流程图


---

## Interface Design Overview

### PC端与Web端交互流程

1. **打开登录页面**:
   - **1.1**: 用户在PC端打开登录页面。

2. **Token获取与使用**:
   - **1.2**: PC端调用登录接口，进行用户身份验证。
   - **1.3**: 快速登录接口的调用，支持快速登录选项。
   - **1.4**: 接收到token后，设置为长时间有效。

3. **Token异常处理**:
   - **1.5**: 所有流程成功返回token后，通知 PC 端持续使用，处理环境异常反馈。

---

### 设备访问与业务处理

1. **设备访问业务**:
   - **2.1**: 用户在PC端查询设备或进行清单等操作，返回401时指示退出登录。
   
2. **创作平台的访问**:
   - **2.3**: 用户访问创作平台，处理相关业务。
   - 返回401时指示退出登录。

3. **JS Bridge及退出登录**:
   - JS Bridge提示用户退出登录，返回401状态。

---

### 3D服务器与AIOT服务器交互

1. **与3D服务器的交互**: 
   - Web端与3D服务器进行数据和业务的交互。
   
2. **与AIOT服务器的交互**:
   - Web端与AIOT服务器进行设备管理和业务处理。

---

### 其他访问与状态处理

- **访问创作平台的其他业务处理**:
   - **2.4**: 用户访问创作平台的其他业务时，如出现401时，会提示用户重新登录PC端。

---

### 整体说明

此图描绘了PC端到Web端的接口交互设计，强调了用户身份验证、token管理、异常处理及与其他系统（如3D服务器和AIOT服务器）的数据交互。通过明确的状态返回（如401错误），不仅提高了用户体验，还优化了系统间的协作和验证机制。

---

如果有其他具体内容需要调整或补充，请告诉我！

### 1.pc登陆状态同步
- pc当前登陆commnity.eufylife域名接口，创作平台makeitreal域名接口，两个token无法互通，
- 解决方案
- 迁移community.eufylife登陆实现代码到makeitreal项目当中，pc替换登陆url
- 新建makeitreal针对pc的登陆页面，登陆之后调用快速登陆接口，保存登陆信息到本地的缓存当中
- 使用创作平台2d编辑器，从本地缓存当中获取用户的信息
- pc端1.1打卡登陆界面，web端1.2调用login接口来到3dserver
- web端1.3调用quick接口来到了aiotserver，web端缓存token长期使用
- web端1.5所有的流程成功返回token返回给pc端本地保存并且长期使用，中间环节失败抛出异常反馈
- 3dserver 2.1访问设备业务，查询设备信息，消息等等，返回401的时候退出登陆，3dserver和pc端之间的交互
- aiot server和pc端之间2.3访问创作平台，业务，云切片业务，返回401的时候退出登陆
- web端401js bridge提示退出登陆到pc端

以下是您提供的接口设计内容的详细整理：

---

### 4.5.3 接口设计

#### 通信方式及指令

| 通信方式                | 指令                          | 协议参数                                                   | 说明                                                        |
|-------------------------|-------------------------------|-----------------------------------------------------------|-------------------------------------------------------------|
| 通过 **jsbridge** 通信 | **sendCommandToPC**          | {<br> "action": "指令参数",<br> "data": "携带参数"<br>} | 通过跨端指令格式，发送数据，接入（例如：pc: anker_msg; app: flutter_inappwebview） |
| 通过 **scheme** 通信   |                               | project_id=${projectModel?.project_id}&source={"2dPrint"}&user_id=${getUserInfo()!.user_id} | 在浏览器的2d编辑器点击打印时，唤起PC打印进行打印                       |

---

### 说明内容

1. **通过 jsbridge 通信**:
   - **sendCommandToPC** 是用于向PC或应用程序发送指令的接口。该接口允许通过参数形式传递指令和动态数据，用于触发特定功能或请求的处理。

2. **通过 scheme 通信**:
   - 提供了一种机制，以便在特定事件发生时（例如点击打印按钮），通过URL模式传递项目ID和用户信息。这样一来，系统能够接收到所需参数以启动打印操作。

### 参数说明

- **action**: 指定要执行的具体操作或命令。
- **data**: 在发送请求时携带的额外数据。
- **project_id**: 当前操作的项目标识，是在系统中唯一标识该项目的字段。
- **user_id**: 当前用户的标识，用于识别请求的来源和权限。

