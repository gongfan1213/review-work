- 1.问题背景，解决思路
- 当前有saas包需要多批次灰度的场景，需要对每个批次创建一个任务，审核时分布审核每个任务，当多个saas包需要灰度时，在确认下发操作难以确定正确的下发顺序（创建，审核，确认下发效率低）
- 解决思路：引入子任务，创建任务会创建多个批次子任务，子任务可以独立下发
- 。任务审核通过后，其下的子任务无需审核可以重复下发。

- 2.效果 界面改动
- (1). 创建任务
- 取消选择任务类型弹窗


- (2). 任务列表：
- 操作按钮:审核通过,审核驳回,禁用
- 	普通用户:禁用
- 	审计员&超级管理员:审核通过/审核驳回操作后变为禁用
- 去掉: 任务类型异常设备数


- (2). 任务详情:
- 原:下发详情前端隐藏

- 详情页面如下图
- 1.任务操作:审核通过/驳回, 禁用（任务列表保持一致）
- 2.删除基本信息中：异常设备数, 升级包md5, 升级包
- 3.增加子任务列表: 批次, 任务状态, 下发设备数, 升级包, 升级包MD5, 操作
- (1)升级包, 升级包MD5: 恒展示最近一次下发包信息
- (2)子任务点击取消任务后，任务状态变成‘可下发’
- (3)任务禁用后，子任务状态变成‘已禁用’，所有子任务无操作按钮，显示 ’-’
- (4)子任务操作会记录日志，日志中携带批次说明
- (5)子任务首次下发要批次递增操作，不能越级


- （3）任务状态流转

- 前端其他改动:
- 下面图片红框是要隐藏的


- 增加字段:任务详情页面的子任务列表在上面的基础上: 增加最近’操作时间’和’下发次数’两个字段
- 3.技术方案
- 子任务实现:
- 数据库表: 增加字段: batch(下发批次)
- 获取任务列表:
- 查询任务详情表, 以task_id去重,返回任务列表
- 子任务下发:
- 子任务下发后状态转为升级中, 升级中点击取消后状态转可下发
- 任务创建:
- 上传1个saas包, 1个csv文件(包含所有批次), 解析csv根据批次创建出多个子任务
- 任务详情: 
- 根据task_id查询数据库中所有子任务,对公共部分去重返回

	



